# -*- coding: utf-8 -*-

from django.shortcuts import get_object_or_404, render_to_response
from django.http import HttpResponseRedirect, HttpResponse
from django.core.urlresolvers import reverse
from django.template import RequestContext
from polls.models import Choice, Poll


def vote(request, poll_id):
    p = get_object_or_404(Poll, pk=poll_id)
    try:
        selected_choice = p.choice_set.get(pk=request.POST['choice'])
    except (KeyError, Choice.DoesNotExist):
        return render_to_response('polls/detail.html', 
            {
                'poll': p,
                'error_message': "You didn't select a choice",
            },
            context_instance=RequestContext(request))
    else:
        selected_choice.votes += 1
        selected_choice.save()
        return HttpResponseRedirect(reverse('poll_results', args=(p.id,)))

from django.core.cache import cache
def cache_set(request):
    output = ""
    for k, v in request.GET.items():
        output += "(%s) = (%s)<br>" % (k,v)
        cache.set(k, v)        
    return HttpResponse(output)


def cache_get(request):
    output = ""
    for k in request.GET.keys():
        v = cache.get(k)        
        output += "(%s) = (%s)<br>" % (k,v)
    return HttpResponse(output)


def send_mail(request):
    from django.core.mail import send_mail
    send_mail(
        '你好，来自BAE的问候', 
        '我们是BAE python团队', 
        'from@example.com',
        ["chenyifei@baidu.com"], fail_silently=False)
    return HttpResponse("send mail success")

def session(request):
    return Httpresponse("session success")

